391 Project Report for Sam Bao, Elvis Lo and Liwen Chen

We are using PHP, MYSQL and WAMP server to do this project. We are using our own windows based servers. 
Website Visual are powered by MetroUICSS jquery bootstrapper http://metroui.org.ua/



The user initially sees the login page, index, where we ask user to input username and password. We process
the username and password in login.php and allow the user into the system if correct. 

After login, the user is directed to the home page. Depending on the classes of the user (Admin, Patient, Doctor or Radiologist), the user can
see different buttons on the home page, done through home.php.
   
Record search and user documentation buttons can be seen by all users, upload pacs image and upload record buttons can be seen only by radiologist and admin, 
user management button can be seen by all users but only admin can see buttons other than change personal info. Report generating button and data analysis 
button can only be seen by admin. Under user management, admin can additionally see buttons for creating a new user, editing user accounts and editing family 
doctor information. 

User management input and some processing is done in modifyinfo.php, with more processing in create_new_user.php, editassignment.php and 
search_account_backend.php.

Under search, user initally reaches search.html, on which users can enter search terms, and a time range to search in between. Either field can be left blank 
and it will be assumed user wants to search for only between a range of time or that the user wishes to search for all time ranges. User is also able to 
specify, by radio buttons, ordering results by most recent, least recent or relevancy.

Regarding user classes, patients can only see their own records, doctors can only see records of their patients, 
radiologists can only see records conducted by themselves, and administrators can see any records in search. This is done by checking user classes and
using different queries for each classes.

Upon search, search_backend.php queries the database and displays results, results being record information including patient name and thumbnails of
relevant images. Thumbnails can be clicked to obtain the regular size image in a separate window.

Example Relevant SQL Statement: (DESC or ASC is chosen by user and changes, similar statements exist to account for user access priveleges)
SELECT record_id, patient_id, first_name, last_name, doctor_id, radiologist_id, test_type, prescribing_date, test_date, 
                                 diagnosis, description
                                 FROM
                                 (SELECT *,
                                 ((3*(MATCH(`first_name`) AGAINST ('".$searchTerm."'))) +
                                     (3*(MATCH(`last_name`) AGAINST ('".$searchTerm."'))) +
                                     (3*(MATCH(`diagnosis`) AGAINST ('".$searchTerm."'))) + 
                                     (1*(MATCH(`description`) AGAINST ('".$searchTerm."'))))  AS score
                                     FROM radiology_record, persons
                                     WHERE ((`prescribing_date` between '".$start_date."' AND '".$end_date."') OR
                                             (`test_date` between '".$start_date."' AND '".$end_date."')) AND
                                             radiology_record.patient_id = persons.person_id) AS TMP
                                             WHERE score > 0
                                             ORDER BY DESC

Under the upload pacs images section, image.php allows the radiologist to enter the id of the record they want to upload the image for and to
pick an image to upload through their file system. image_backend.php processes the request by formatting the image, generating thumbnail and regular size
versions, and inserting them. An image_id is generated by querying for the max image_id in the database.

Relevant SQL Statements:
INSERT INTO pacs_images VALUES ('$record_id', '$new_id', '$thumbnail', '$normalSize', '$image')

SELECT MAX(`image_id`) FROM pacs_images

The upload record section simply allows a radiologist to enter all relevant information to upload a new record in upload.php. 
A unique record id is automatically generated and the record is uploaded, this processing is done in upload_backend.php.

Relevant SQL Statement:
INSERT INTO radiology_record VALUES ('$ID','$doctor_id','$patient_id','$radiologist_id','$test_type','$prescribing_date','$test_date','$diagnosis','$description');

The generate report section allows an admin to search for all records with a specific diagnosis within a specific time frame. The time range can be left
blank and it will be assumed that user wishes to search in all time ranges. User enters information in report.php, and processing is done in report_backend.php
where relevant records are queried for.

Relevant SQL Statement:
SELECT persons.first_name, persons.last_name, persons.address, persons.phone
FROM persons, radiology_record
WHERE radiology_record.diagnosis LIKE '$search_diagnosis' AND
        radiology_record.patient_id = persons.person_id

The data analysis section then takes the admin to analysis.php, in which the admin can specify a time range to analyze. The admin must specify a time
range or no results will be shown. The admin will then reach the analysis_backend.php page, on which the admin can use checkboxes and radio buttons 
to choose to display by patient, by test type, by both, or neither, weekly, monthly or yearly. Processing is done by creating a temporary table, creating
and storing data cube information in the temporary table (done manually as MySQL is being used for the process), and then querying from the temporary table.
The temporary table is local to the session and disappears upon the session ending.

Relevant SQL Statements:
 -- Create a temporary table to store data cube information.
CREATE TEMPORARY TABLE TEMPTABLE(
                               `patient_id` int(11) DEFAULT NULL,
                               `first_name` varchar(24) DEFAULT NULL,
                               `last_name` varchar(24) DEFAULT NULL,
                               `test_type` varchar(24) DEFAULT NULL,
                               `test_date` date DEFAULT NULL,
                               `count` int(11))

 --	Creating data cube and storing in the temporary table:
INSERT INTO TEMPTABLE (select * 
                        FROM(select patient_id,first_name,last_name, test_type,test_date,count(record_id)
                            from radiology_record, persons
                            where radiology_record.patient_id = persons.person_id 
                            group by patient_id,test_type,test_date
                            union
                            select patient_id,first_name,last_name, null,test_date,count(record_id)
                            from radiology_record , persons
                            where radiology_record.patient_id = persons.person_id 
                            group by patient_id,test_date
                            union 
                            select patient_id,first_name,last_name, test_type,null,count(record_id)
                            from radiology_record , persons
                            where radiology_record.patient_id = persons.person_id 
                            group by patient_id,test_type
                            union
                            select null,null,null,test_type,test_date,count(record_id)
                            from radiology_record 
                            group by test_type, test_date

                            union
                            select null,null,null,null,test_date,count(record_id)
                            from radiology_record 
                            group by test_date
                            union
                            select patient_id,first_name,last_name, null,null,count(record_id)
                            from radiology_record , persons
                            where radiology_record.patient_id = persons.person_id 
                            group by patient_id

                            union
                            select null,null,null,test_type,null,count(record_id)
                            from radiology_record 
                            group by test_type
                            union
                            select null,null,null,null,null,count(record_id)
                            from radiology_record ) AS temp)

 -- Queries are then done on the temporary table, for example: (There are many more similar queries)
 SELECT patient_id, first_name, last_name, SUM(count)
 FROM TEMPTABLE
 WHERE patient_id IS NOT NULL AND
         test_type IS NULL AND
         test_date BETWEEN '$timestamp_date' AND '$next_timestamp_date'
 GROUP BY patient_id, first_name, last_name

Finally, user documentation contains instructions on installation and a user manual.







